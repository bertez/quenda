/**
 * quenda - A simple javascript function queue.
 * @version v0.0.1
 * @author Berto Yáñez <berto@ber.to>
 * @link https://github.com/bertez/quenda
 * @license MIT
 */

!function(e,t){"function"==typeof define&&define.amd?define(["merge"],t):"object"==typeof module&&module.exports?module.exports=t(require("merge")):e.Quenda=t(e.merge)}(this,function(e){"use strict";var t={loop:!1,defaultDelay:1e3,maxLoops:1/0},n={queues:[],prototype:{add:function(e){if(!e)throw new Error("Not enough arguments");if(Array.isArray(e))e.forEach(function(e){this.add(e)},this);else{if(e.nextDelay<0)throw new Error("Steps shold have at least a nextDelay property greater than 0");this.steps.push(e)}return this},play:function(){return this._ExecuteNext(this._getNext()),this.paused=!1,this},pause:function(){return this._currentTimeout&&clearTimeout(this._currentTimeout),this.paused=!0,this},next:function(){return this.pause(),this.play(),this},getSteps:function(){return this.steps},_current:0,loops:0,_ExecuteNext:function(e){if(e.autoDestroy){var t=this.steps.indexOf(e);--this._current,this.steps.splice(t,1)}e.preload&&!e.preloaded?this._handlePreload(e.preload,function(){this._setNextTimeout(parseInt(e.nextDelay,10)),e.preloaded=!0,e.fn&&e.fn()}.bind(this)):(this._setNextTimeout(parseInt(e.nextDelay)),e.fn&&e.fn())},_getNext:function(){var e;if(this._current===this.steps.length){if(!(this.config.loop&&this.loops<this.config.maxLoops))return;this.loops++,e=this._current=0}else e=this._current;return this._current++,this.steps[e]},_setNextTimeout:function(e){this.paused||(this._currentTimeout=setTimeout(function(){this._ExecuteNext(this._getNext())}.bind(this),e||this.config.defaultDelay))},_handlePreload:function(e,t){var n=0;e.forEach(function(s){var i=new Image;i.onload=function(){++n,n===e.length&&t()},i.src=s})}},getAll:function(){return this.queues},deleteAll:function(){this.getAll().forEach(function(e){e.instance.pause()}),this.queues=[]},"delete":function(e){var t=this.queues.splice(e,1);return t[0].instance.pause(),this},"new":function(n,s){if(n&&n!==Object(n))throw new Error("Config object should be a key/value object.");var i=Object.create(this.prototype);return this.queues.push(s?{name:s,instance:i}:{instance:i}),i.config=e({},t,n),i.steps=[],i}};return n});